<html>
    <body>
        <h1>Will's super cool Game</h1>
        <h2>Waiting for players...</h2>

        <div id="game"></div>

        <script src="http://cdnjs.cloudflare.com/ajax/libs/socket.io/0.9.16/socket.io.min.js"></script>
        <script src="/static/front_end_engine.js"></script>
        <script>
            var game = new Game();
            var name = prompt("Enter a player name:").replace(/ /g,'');
            var local_player = null;
            var remote_player = null;

            function bind_key_listeners(){
                 document.onkeydown = function(event){
                    if(event.keyCode == 38){
                        socket.emit('update player',JSON.stringify({name:name,direction:"up"}));
                    }
                    if(event.keyCode == 37){
                        socket.emit('update player',JSON.stringify({name:name,direction:"left"}));
                    }
                    if(event.keyCode == 39){
                        socket.emit('update player',JSON.stringify({name:name,direction:"right"}));
                    }
                    if(event.keyCode == 40){
                        socket.emit('update player',JSON.stringify({name:name,direction:"down"}));
                    }
                };  
            }

            var socket = io.connect('http://localhost:5000');
            socket.emit('new player', name);
            socket.on('game info', function(msg) {
                if(game.started == false){
                    bind_key_listeners();
                    game.init("game");
                    document.getElementsByTagName("h2")[0].remove();
                }

                game.update_food(msg.food);
                for(var i = 0; i < msg.players.length; i++){
                    game.update_player(msg.players[i]);
                }
           });
           socket.on('game end', function(msg){
                alert('Game over! Winner is '+msg.winner);
                document.onkeydown = null;
           });
        </script>
            </body>
</html>
